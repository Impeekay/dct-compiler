<% if current_user %>
  <div class="row">
    <div class="col-md-6">
      <h2>Compiler</h2>
      <div class="form-inline">
      <select class="form-control-sm col-lg-3" name="language" id="sel">
        <option value="ruby">Ruby</option>
        <option value="javascript">JavaScript</option>
        <option value="python">Python3</option>
      </select><br><br>
    </div>
      <div id="text" class="card card-outline mb-3">

      </div>
      <button type="button" name="execute" id="load" class="btn btn-primary">Execute</button>
    </div>

    <div class="col-md-6" id="para">
      <h2>Output</h2>
      <div id="result" class="card card-outline mb-3 top-margin">

      </div>
    </div>
  </div>
  <% else %>
  <span>Login/signup to write and compile code</span><br><br>
  <% end %>
<script type="text/javascript">
lang = "ruby";
eName = "<%= current_user.try(:username) + "_" + @assignment.id.to_s %>";
var editor = CodeMirror(document.getElementById('text'),{
  value: "#type code here",
  mode: "ruby",
  lineNumbers: true,
  keyMap: "sublime",
  theme: "eclipse",
	tabSize: 2,
	indentUnit: 2,
	smartIndent: true,
	indentWithTabs: true,
	tabIndex: 2
});
var result = CodeMirror(document.getElementById('result'),{
  value: "Your result appears here",
  mode: "text",
  keyMap: "sublime",
  theme: "eclipse",
  tabSize: 2,
  tabIndex: 2,
  readOnly: "nocursor"
});

  $("#sel").change(function(){
    var js = "//type code here";
    var pythoncon = "#type code here";
    var rubycon = "#type code here";
    lang = this.value;
    $.ajax({
      url: "<%= home_check_cache_path %>",
      type: "get",
      data: {
        name: eName,
        extension: lang
      },
      success: function(response){
        resp = response["response"];
        if(resp == "default"){
        switch (lang) {
          case "python":
            editor.setOption("value",js);
            editor.setOption("value", pythoncon);
            break;
          case "javascript":
            editor.setOption("value", js);
            break;
          default:
            editor.setOption("value",js);
            editor.setOption("value",rubycon);
            break;
        }
      }else{
        switch (lang) {
          case "python":
            editor.setOption("value",js);
            editor.setOption("value",resp);
            break;
          case "javascript":
            editor.setOption("value",resp);
            break;
          default:
            editor.setOption("value",js);
            editor.setOption("value",resp);
            break;
        }
      }
        editor.setOption("mode",lang);
      }
    });
  });

  $("#load").click(function(){
      var sent = editor.getValue();
      //debugger
      if(sent == "" || eName == ""){
        alert('empty');
      }else{
      // console.log(content);
      $.ajax({
        url: "<%= home_input_path%>",
        type: "get",
        data: {
          name: eName,
          content: sent,
          extension: lang
        },
        success: function(response){
          result.setOption("value", response["response"]);
        }
      });
    }
  });

</script>
